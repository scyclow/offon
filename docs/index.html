<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Have You Tried Turning It Off and On Again?</title>
  <link rel="shortcut icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxzdHlsZT4uYmxpbmt7YW5pbWF0aW9uOkJsaW5rIDJzIHN0ZXBzKDIsc3RhcnQpIGluZmluaXRlfUBrZXlmcmFtZXMgQmxpbmt7dG97dmlzaWJpbGl0eTpoaWRkZW59fTwvc3R5bGU+PHRleHQgY2xhc3M9ImJsaW5rIiBmb250LXNpemU9IjE3OTJweCIgeD0iOTYiIHk9IjE2MjQiIHN0eWxlPSJhbmltYXRpb24tZGVsYXk6IGNhbGMoLTJzKig1LzIwKSAqMTQ5OC8yMDAwMCkiPvCflqXvuI88L3RleHQ+PC9zdmc+">



  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="Have You Tried Turning It Off and On Again?">
  <meta name="keywords" content="have you tried turning it off and on again?, steviep, steve pikelny, pikelny, have, you, tried, turning,it, off, and, on, again, nft, 1of1, smart contract art, art, crypto, ethereum, bitcoin">

  <meta name="twitter:image" content="hdata:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxzdHlsZT4uYmxpbmt7YW5pbWF0aW9uOkJsaW5rIDJzIHN0ZXBzKDIsc3RhcnQpIGluZmluaXRlfUBrZXlmcmFtZXMgQmxpbmt7dG97dmlzaWJpbGl0eTpoaWRkZW59fTwvc3R5bGU+PHRleHQgY2xhc3M9ImJsaW5rIiBmb250LXNpemU9IjE3OTJweCIgeD0iOTYiIHk9IjE2MjQiIHN0eWxlPSJhbmltYXRpb24tZGVsYXk6IGNhbGMoLTJzKig1LzIwKSAqMTQ5OC8yMDAwMCkiPvCflqXvuI88L3RleHQ+PC9zdmc+">
  <meta name="twitter:image:alt" content="Have You Tried Turning It Off and On Again?">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@steviepxyz">
  <meta name="twitter:site" content="@steviepxyz">
  <meta property="twitter:description" content="Have You Tried Turning It Off and On Again?">

  <meta name="og:image" property="og:image" content="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjA0OCAyMDQ4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxzdHlsZT4uYmxpbmt7YW5pbWF0aW9uOkJsaW5rIDJzIHN0ZXBzKDIsc3RhcnQpIGluZmluaXRlfUBrZXlmcmFtZXMgQmxpbmt7dG97dmlzaWJpbGl0eTpoaWRkZW59fTwvc3R5bGU+PHRleHQgY2xhc3M9ImJsaW5rIiBmb250LXNpemU9IjE3OTJweCIgeD0iOTYiIHk9IjE2MjQiIHN0eWxlPSJhbmltYXRpb24tZGVsYXk6IGNhbGMoLTJzKig1LzIwKSAqMTQ5OC8yMDAwMCkiPvCflqXvuI88L3RleHQ+PC9zdmc+">
  <meta name="og:image:alt" content="Have You Tried Turning It Off and On Again?">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://steviep.xyz/offon">
  <meta property="og:title" content="Have You Tried Turning It Off and On Again?">
  <meta property="og:site_name" content="Have You Tried Turning It Off and On Again?">
  <meta property="og:description" content="Have You Tried Turning It Off and On Again?">

  <style type="text/css">
    * {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }

    body {
      background: #fefefe;
    }

    h1 {
      text-align: center;
      font-size: 3em;
      padding: 0.5em;
    }

    @media (max-width: 580px) {
      h1 {
        font-size: 2em;
      }
    }

    button {
      font-size: 2em;
      padding: 0.5em 1em;
      cursor: pointer;
    }


    .center {
      margin: auto;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .error {
      color: #f00;
      text-align: center;
      margin: 0.25em 0;
    }

    #display {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #display img {
      box-shadow: 0px 0px 10px #888;
      margin: 2vw;
      box-sizing: border-box;
      max-height: 70vh;
    }

  </style>
</head>
<body>
<main>
  <h1>Have You Tried Turning It Off and On Again?</h1>

  <section>
    <connect-wallet id="wallet-connect">
      <section slot="noWeb3">
        <h2 class="error center">Please visit this website in a web3-connected browser</h2>
      </section>

      <section slot="notConnected">
        <section id="connectWalletSection" class="center">
          <connect-button>
            <button slot="button">Connect Wallet</button>
            <div slot="loading">Loading...</div>
            <div slot="error" class="error"></div>
          </connect-button>
        </section>
      </section>

      <section slot="connected">
        <div id="display"></div>
        <div id="console"  class= "center" style="display: none;">
          <button id="turnOffButton" style="display: none;">Turn Off</button>
          <button id="turnOnButton" style="display: none;">Turn On</button>
          <h2 id="processing" style="display: none;">Processing...</h2>
        </div>
      </section>
    </connect-wallet>
  </section>
</main>
</body>

<script src="./$.js"></script>
<script src="./webComponents.js"></script>
<script src="./web3Components.js"></script>
<script src="./connectWallet.js"></script>
<script src="./min.ethers.js"></script>

<script type="text/javascript">
  const provider = new Web3Provider()
  mountComponents(
    ConnectWallet(provider, 'connectWallet'),
    ConnectButton(provider),
  )

  const network = 'goerli'

  const OFFON = {
    goerli: '0x0A0ED41c68fa65Dc43d6045afd41fbF2117DBD2E'
  }[network]


  const OFFON_DEMO = {
    goerli: '0x8A1F75AcFDCd52D1e64714E40EC463762951783e'
  }[network]

  const offonABI = [
    'function tokenURI(uint256) external view returns (string)',
    'function isOn() external view returns (bool)',
    'function turnOff() external',
    'function turnOn() external',
    'function ownerOf(uint256) external view returns (address)',
  ]

  const offonDemoABI = [
    'function turnOff() external',
    'function turnOn() external',
  ]

  const $display = $.id('display')
  const $console = $.id('console')
  const $turnOffButton = $.id('turnOffButton')
  const $turnOnButton = $.id('turnOnButton')
  const $processing = $.id('processing')


  provider.onConnect(async () => {
    const offon = await provider.contract(OFFON, offonABI)
    const offonDemo = await provider.contract(OFFON_DEMO, offonDemoABI)

    const [tokenURI, owner, isOn, signerAddr] = await Promise.all([
      offon.tokenURI(0),
      offon.ownerOf(0),
      offon.isOn(),
      provider.signer.getAddress()
    ])

    const tokenURIStr = tokenURI.replace('data:application/json;utf8,', '')

    $display.innerHTML = `<img src="${JSON.parse(tokenURIStr).image}">`

    console.log(owner, signerAddr, offonDemo.address)

    if (owner === signerAddr || owner === offonDemo.address) {
      console.log('blah')
      unhide($console)
    }

    if (isOn) {
      unhide($turnOffButton)
    } else {
      unhide($turnOnButton)
    }


    const offonController = owner === offonDemo.address ? offonDemo : offon

    $turnOffButton.onclick = async () => {
      const tx = await offonController.connect(provider.signer).turnOff()
      unhide($processing)
      hide($turnOffButton)

      const txReciept1 = await tx.wait(1)
      hide($processing)
      unhide($turnOnButton)

      const tokenURI = await offon.tokenURI(0)
      const tokenURIStr = tokenURI.replace('data:application/json;utf8,', '')
      $display.innerHTML = `<img src="${JSON.parse(tokenURIStr).image}">`
    }

    $turnOnButton.onclick = async () => {
      const tx = await offonController.connect(provider.signer).turnOn()
      unhide($processing)
      hide($turnOnButton)

      const txReciept1 = await tx.wait(1)
      hide($processing)
      unhide($turnOffButton)

      const tokenURI = await offon.tokenURI(0)
      const tokenURIStr = tokenURI.replace('data:application/json;utf8,', '')
      $display.innerHTML = `<img src="${JSON.parse(tokenURIStr).image}">`
    }

  })


function unhide(element) {
  $(element, 'display', '')
}

function hide(element) {
  $(element, 'display', 'none')
}
</script>
</html>